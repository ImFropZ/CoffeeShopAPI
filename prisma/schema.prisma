generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id             String         @id @default(uuid())
  fullName       String         @default("No Name")
  email          String?        @unique
  username       String         @unique
  hashedPassword String
  role           Role           @default(USER)
  roleId         Role           @default(USER)
  invoices       Invoice[]
  passwordReset  PasswordReset?
}

model Customer {
  id       String    @id @default(uuid())
  name     String
  phone    String?
  address  String?
  invoices Invoice[]
}

enum Role {
  ADMIN
  STOCK
  CASHIER
  USER
}

model Stock {
  id               String            @id @default(uuid())
  name             String
  items            StockItem[]
  stockReportItems StockReportItem[]
}

model StockItem {
  id               String            @id @default(uuid())
  expiresDate      DateTime
  quantity         Int
  price            Decimal
  stock            Stock             @relation(fields: [stockId], references: [id])
  stockId          String
  stockReportItems StockReportItem[]
}

model StockReport {
  id               String            @id @default(uuid())
  createdAt        DateTime          @default(now())
  stockReportItems StockReportItem[]
}

model StockReportItem {
  id            String      @id @default(uuid())
  quantity      Int
  stock         Stock       @relation(fields: [stockId], references: [id])
  stockId       String
  stockItem     StockItem   @relation(fields: [stockItemId], references: [id])
  stockItemId   String
  stockReport   StockReport @relation(fields: [stockReportId], references: [id])
  stockReportId String
}

model Menu {
  id           String        @id @default(uuid())
  name         String
  price        Decimal
  cupSize      CupSize
  picture      String
  isActive     Boolean       @default(true)
  invoiceItems InvoiceItem[]

  @@unique([name, cupSize])
}

model Invoice {
  id         String        @id @default(uuid())
  createdAt  DateTime      @default(now())
  customer   Customer?     @relation(fields: [customerId], references: [id])
  customerId String?
  user       User          @relation(fields: [userId], references: [id])
  userId     String
  items      InvoiceItem[]
}

model InvoiceItem {
  id        String   @id @default(uuid())
  quantity  Int
  sugar     Float
  ice       Float
  price     Decimal  @default(0)
  attribute String
  menu      Menu     @relation(fields: [menuId], references: [id])
  menuId    String
  invoice   Invoice? @relation(fields: [invoiceId], references: [id])
  invoiceId String?
}

enum CupSize {
  SMALL
  MEDIUM
  LARGE
}

model PasswordReset {
  id        String   @id @default(uuid())
  token     String   @unique
  createdAt DateTime @default(now())
  expiresAt DateTime
  user      User     @relation(fields: [userId], references: [id])
  userId    String   @unique
}
